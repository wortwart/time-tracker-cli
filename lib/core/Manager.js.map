{"version":3,"sources":["../../src/core/Manager.js"],"names":["Manager","cfg","repositories","tasks","all","config","key","task","update","get","Object","assign","set","description","t","getTask","start","then","storeTask","console","log","toISOString","catch","pause","unpause","stop","text","setDescription","name","getSeconds","operation","stringTime","makeOperationOverTime","string","keys","forEach","indexOf","push","search","map","k","join","length","prompt","type","message","default","answers","cls","unflatten","element","value","configElements","toString","newCfg","newTasks","migratedTasks","rate","full","status"],"mappings":"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","file":"Manager.js","sourcesContent":["import flat from 'flat'\nimport moment from 'moment'\nimport inquirer from 'inquirer'\n\nimport Task from './Task'\nimport {recognizeModifierTiming} from './utils'\nimport {STARTED, PAUSED, UNPAUSED, IN_PROGRESS, FINISHED, configElements} from './constants'\nimport {summarize, outputVertical, cliError, cliSuccess} from './output'\nimport {migrateToV2} from './dbMigrations'\n\nexport default class Manager {\n\n\trepositories = ['tasks', 'config']\n\n\tconstructor(cfg) {\n\t\tthis.cfg = cfg\n\t\tthis.tasks = cfg.all.tasks\n\t\tthis.config = (cfg.all.config) ? cfg.all.config : {}\n\t}\n\n\tgetTask(key) {\n\t\tlet task = (this.tasks[key]) ? this.tasks[key] : null\n\t\treturn new Task(task)\n\t}\n\n\tstoreTask(key, task) {\n\t\tlet update = {}\n\t\tupdate[key] = task.get()\n\t\tthis.tasks = Object.assign({}, this.tasks, update)\n\t\tthis.cfg.set('tasks', this.tasks)\n\t}\n\n\tstartTask(key, description) {\n\t\tlet t = this.getTask(key)\n\t\tt.start(description)\n\t\t\t.then(() => {\n\t\t\t\tthis.storeTask(key, t)\n\t\t\t\tconsole.log(\n\t\t\t\t\toutputVertical('Task:', key, STARTED, moment().toISOString())\n\t\t\t\t)\n\t\t\t}, cliError)\n\t\t\t.catch(cliError)\n\t}\n\n\tpauseTask(key) {\n\t\tlet t = this.getTask(key)\n\t\tt.pause()\n\t\t\t.then(()=>{\n\t\t\t\tthis.storeTask(key, t)\n\t\t\t\tconsole.log(\n\t\t\t\t\toutputVertical('Task:', key, PAUSED, moment().toISOString())\n\t\t\t\t)\n\t\t\t}, cliError)\n\t\t\t.catch(cliError)\n\t}\n\n\tunpauseTask(key) {\n\t\tlet t = this.getTask(key)\n\t\tt.unpause()\n\t\t\t.then(()=>{\n\t\t\t\tthis.storeTask(key, t)\n\t\t\t\tconsole.log(\n\t\t\t\t\toutputVertical('Task:', key, UNPAUSED, moment().toISOString())\n\t\t\t\t)\n\t\t\t}, cliError)\n\t\t\t.catch(cliError)\n\t}\n\n\tstopTask(key, description) {\n\t\tlet t = this.getTask(key)\n\t\tt.stop(description)\n\t\t\t.then(()=>{\n\t\t\t\tthis.storeTask(key, t)\n\t\t\t\tconsole.log(\n\t\t\t\t\toutputVertical('Task:', key, FINISHED, moment().toISOString())\n\t\t\t\t)\n\t\t\t}, cliError)\n\t\t\t.catch(cliError)\n\t}\n\n\taddDescription(key, text) {\n\t\tlet t = this.getTask(key)\n\t\tt.setDescription(text)\n\t\tthis.storeTask(key, t)\n\t}\n\n\tgetTime(name) {\n\t\tlet t = this.getTask(name)\n\t\treturn t.getSeconds()\n\t}\n\n\tmodifyTask(operation, name, stringTime) {\n\t\tlet t = this.getTask(name)\n\t\tt.makeOperationOverTime(operation, stringTime)\n\t\t\t.then(()=>{\n\t\t\t\tthis.storeTask(name, t)\n\t\t\t}, cliError)\n\t\t\t.catch(cliError)\n\t}\n\n\tsearch(string) {\n\t\tlet keys = Object.keys(this.tasks)\n\t\tlet tasks = []\n\t\tkeys.forEach((key)=>{\n\t\t\tif (string === 'all' || key.indexOf(string) > -1){\n\t\t\t\ttasks.push({\n\t\t\t\t\tname: key,\n\t\t\t\t\ttask: new Task(this.tasks[key])\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t\treturn tasks\n\t}\n\n\tdelete(string) {\n\t\tlet tasks = this.search(string)\n\t\tconsole.log(tasks.map(k => `${k.name} \\n`).join(''))\n\t\tif (tasks.length === 0) {\n\t\t\tcliSuccess('No tasks found to delete.')\n\t\t\treturn\n\t\t}\n\t\tinquirer.prompt([{\n\t\t\ttype: 'confirm',\n\t\t\tname: 'cls',\n\t\t\tmessage: `Are you sure you want to delete this tasks?`,\n\t\t\tdefault: false\n\t\t}]).then((answers) => {\n\t\t\tif (answers.cls){\n\t\t\t\ttasks.forEach(k => {\n\t\t\t\t\tdelete this.tasks[k.name]\n\t\t\t\t\tthis.cfg.set('tasks', this.tasks)\n\t\t\t\t})\n\t\t\t\tcliSuccess('Tasks deleted.')\n\t\t\t}\n\t\t})\n\t\t.catch(cliError)\n\t}\n\n\tgetTasksJson() {\n\t\treturn flat.unflatten(this.tasks)\n\t}\n\n\tgetConfig() {\n\t\treturn this.config\n\t}\n\n\tconfigure(element, value) {\n\t\tif (configElements.indexOf(element) < 0)\n\t\t\treturn cliError(`Config key (${element}) not allowed, allowed keys: ${this.configElements.toString()} `)\n\t\tlet newCfg = {[element]: value}\n\t\tthis.config = Object.assign({}, this.config, newCfg)\n\t\tthis.cfg.set('config', this.config)\n\t\treturn this.config\n\t}\n\n\tupdate() {\n\t\tif (!this.config || (this.config && this.config['config.version'] !== '2') ) {\n\t\t\tconsole.log('DB: Need to be updated')\n\t\t\tmigrateToV2(this.tasks)\n\t\t\t\t.then(tasks => {\n\t\t\t\t\tlet newTasks = {}\n\t\t\t\t\ttasks.forEach(t => newTasks[t.key] = t.task)\n\t\t\t\t\treturn newTasks\n\t\t\t\t})\n\t\t\t\t.then(migratedTasks => {\n\t\t\t\t\tthis.cfg.set('tasks', migratedTasks)\n\t\t\t\t\tthis.cfg.set('config', Object.assign(this.config, {\n\t\t\t\t\t\t'config.version': '2'\n\t\t\t\t\t}))\n\t\t\t\t\tcliSuccess('Configuration migrated to version 2.')\n\t\t\t\t}, cliError)\n\t\t\t\t.catch(cliError)\n\t\t} else {\n\t\t\tcliSuccess('No need to update the DB.')\n\t\t}\n\t}\n\n\tsummarize(key, rate, full=true) {\n\t\tlet tasks = this.search(key)\n\t\tsummarize(key, tasks, rate, full, this.config['format.output'])\n\t}\n\n\tgetStatus() {\n\t\tObject.keys(this.tasks).forEach((key) => {\n\t\t\tconsole.log(key, this.tasks[key].status, this.tasks[key].log[this.tasks[key].log.length - 1])\n\t\t})\n\t}\n\n}\n"]}